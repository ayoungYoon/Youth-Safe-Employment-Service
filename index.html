<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì²­ì†Œë…„ ë…¸ë™ê¶Œ ìƒë‹´ ì›¹ì‚¬ì´íŠ¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }

    header {
      background-color: #0069d9;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    nav {
      display: flex;
      justify-content: center;
      background-color: #ddd;
    }

    nav button {
      padding: 1rem;
      border: none;
      background: #ddd;
      cursor: pointer;
      font-size: 1rem;
      width: 50%;
    }

    nav button.active {
      background: white;
      font-weight: bold;
      border-bottom: 2px solid #0069d9;
    }

    .tab-content {
      display: none;
      padding: 1rem;
    }

    .tab-content.active {
      display: block;
    }

    /* ê³µí†µ ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
    input, button, select {
      padding: 0.5rem;
      margin: 0.5rem 0;
      font-size: 1rem;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
    }

    button {
      background-color: #0069d9;
      color: white;
      border: none;
      cursor: pointer;
    }

    #chat {
      height: 300px;
      overflow-y: auto;
      background: white;
      padding: 1rem;
      border: 1px solid #ccc;
      margin-bottom: 1rem;
    }

    @media screen and (max-width: 600px) {
      nav button {
        font-size: 0.9rem;
        padding: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ›¡ ì²­ì†Œë…„ ë…¸ë™ê¶Œ ë³´í˜¸ AI</h1>
  </header>

  <nav>
    <button id="tabCalc" class="active" onclick="switchTab('calc')">ğŸ§® ìµœì €ì„ê¸ˆ ê³„ì‚°ê¸°</button>
    <button id="tabChat" onclick="switchTab('chat')">ğŸ’¬ ëŒ€ì‘ ì±—ë´‡</button>
  </nav>

  <!-- ê³„ì‚°ê¸° íƒ­ -->
  <div id="calc" class="tab-content active">
    <h2>ğŸ§® ìµœì €ì„ê¸ˆ & ì£¼íœ´ìˆ˜ë‹¹ ê³„ì‚°</h2>
    <label>í•œ ë‹¬ ê¸‰ì—¬ (ì›):</label><br>
    <input type="number" id="salary" /><br>
    <label>ì¼í•œ ì£¼ë‹¹ ì‹œê°„:</label><br>
    <input type="number" id="weeklyHours" /><br>
    <label>ì‹œê¸‰ (í˜„ì¬ ìµœì €ì‹œê¸‰ì€ 10030ì›):</label><br>
    <input type="number" id="hourlyWage" value="10030" /><br>
    <button onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>

    <div id="calcResult" style="margin-top: 1rem;"></div>
  </div>

  <!-- ì±—ë´‡ íƒ­ -->
  <div id="chat" class="tab-content">
    <h2>ğŸ’¬ ë¶€ë‹¹ëŒ€ìš° ëŒ€ì‘ ì±—ë´‡</h2>
    <input type="file" id="csvFile" accept=".csv" /><br>
    <div id="chatBox"></div>

    <input type="text" id="userInput" placeholder="ê¶ê¸ˆí•œ ì ì„ ì…ë ¥í•˜ì„¸ìš”..." />
    <button onclick="handleChat()">ì „ì†¡</button>
  </div>

  <script>
    // íƒ­ ì „í™˜
    function switchTab(tab) {
      document.querySelectorAll(".tab-content").forEach(div => div.classList.remove("active"));
      document.getElementById(tab).classList.add("active");

      document.getElementById("tabCalc").classList.remove("active");
      document.getElementById("tabChat").classList.remove("active");
      document.getElementById("tab" + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add("active");
    }

    // ê³„ì‚°ê¸° ë¡œì§
    function calculate() {
      const salary = parseInt(document.getElementById("salary").value);
      const hours = parseFloat(document.getElementById("weeklyHours").value);
      const wage = parseInt(document.getElementById("hourlyWage").value);

      const isEligible = hours >= 15;
      const weeklyPay = hours * wage;
      const weeklyHolidayPay = isEligible ? ((hours / 40) * 8 * wage) : 0;
      const totalPay = (weeklyPay + weeklyHolidayPay) * 4;

      let result = `ìµœì €ì„ê¸ˆ ê¸°ì¤€ í•œ ë‹¬ ì´ ì˜ˆìƒê¸‰ì—¬: <strong>${totalPay.toLocaleString()}ì›</strong><br>`;
      result += `ì£¼íœ´ìˆ˜ë‹¹ í¬í•¨ ì—¬ë¶€: <strong>${isEligible ? "âœ”ï¸ ì§€ê¸‰ ëŒ€ìƒ" : "âŒ ëŒ€ìƒ ì•„ë‹˜"}</strong><br>`;
      result += `ì…ë ¥í•œ ê¸‰ì—¬ <strong>${salary.toLocaleString()}ì›</strong>ì€ `;
      result += (salary >= totalPay) ? "<span style='color:green;'>âœ”ï¸ ì ì ˆí•©ë‹ˆë‹¤</span>" : "<span style='color:red;'>âŒ ë¶€ì¡±í•©ë‹ˆë‹¤</span>";

      document.getElementById("calcResult").innerHTML = result;
    }

    // ì±—ë´‡ ë¡œì§
    let responses = [];

    document.getElementById("csvFile").addEventListener("change", function(event) {
      Papa.parse(event.target.files[0], {
        header: true,
        complete: function(results) {
          responses = results.data;
          addChat("ğŸ¤–", "CSV ì—…ë¡œë“œ ì™„ë£Œ! ì´ì œ ê¶ê¸ˆí•œ ì ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
        }
      });
    });

    function handleChat() {
      const input = document.getElementById("userInput").value.trim();
      if (!input) return;
      addChat("ğŸ‘¤", input);

      const best = getBestMatch(input, responses);
      if (best && best.score > 0.5) {
        addChat("ğŸ¤–", best.response);
      } else {
        addChat("ğŸ¤–", "ì£„ì†¡í•´ìš”. ì§ˆë¬¸ì„ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      }

      document.getElementById("userInput").value = "";
    }

    function getBestMatch(input, data) {
      let best = { keyword: "", response: "", score: 0 };
      for (let pair of data) {
        let score = getSimilarity(input, pair.keyword);
        if (score > best.score) {
          best = { ...pair, score };
        }
      }
      return best;
    }

    function getSimilarity(a, b) {
      a = a.toLowerCase();
      b = b.toLowerCase();
      const aChars = a.replace(/[^\wê°€-í£]/g, "").split("");
      const bChars = b.replace(/[^\wê°€-í£]/g, "").split("");

      let match = 0;
      aChars.forEach(char => {
        if (bChars.includes(char)) match++;
      });

      return match / Math.max(aChars.length, bChars.length);
    }

    function addChat(sender, text) {
      const chatBox = document.getElementById("chatBox");
      const message = document.createElement("div");
      message.innerHTML = `<strong>${sender}</strong>: ${text}`;
      chatBox.appendChild(message);
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  </script>
</body>
</html>
